# USB3.0 HUB 接线图详解

## 设计概述

本文档说明5路USB3.0 HUB的连接方式和系统架构。经过分析，我们采用集成连接方案，将CH340G串口转USB模块集成到HUB内部，实现PC端单线连接的便利性。

## 实际连接方案

### 方案一：独立串口连接（推荐）

```
PC端 USB接口
    │
    ├─── USB Type-A 接口1 ──→ GL3523 USB3.0 HUB ──┬─── USB端口1
    │                                              ├─── USB端口2  
    │                                              ├─── USB端口3
    │                                              └─── USB端口4
    │
    └─── USB Type-A 接口2 ──→ CH340G串口转USB ──→ STM32F767 UART
```

**说明：**
- PC需要提供2个USB接口
- GL3523 USB HUB提供4路用户端口
- CH340G独立连接到PC的另一个USB接口
- STM32通过UART与CH340G通信

### 推荐方案：集成连接（5路HUB）

```
PC端 USB接口
    │
    └─── USB Type-A 接口 ──→ GL3525 USB3.0 HUB ──┬─── USB端口1（用户端口）
                           (5路HUB)              ├─── USB端口2（用户端口）
                                                  ├─── USB端口3（用户端口）
                                                  ├─── USB端口4（用户端口）
                                                  └─── CH340G串口转USB ──→ STM32F767 UART
                                                       （系统端口）
```

**说明：**
- PC只需要1个USB接口，部署极其简便
- 使用5路USB HUB芯片（GL3525）
- CH340G占用HUB的端口5，专用于系统通信
- 端口1-4为用户设备端口，可控切换
- 高集成度设计，符合工业级产品趋势

## 推荐方案对比

| 特性 | 方案一（独立串口） | 方案二（集成连接）推荐 |
|------|-------------------|------------------------|
| PC USB接口需求 | 2个 | 1个 |
| HUB芯片 | GL3523（4路） | GL3525（5路） |
| 成本 | 较低 | 较高 |
| 可靠性 | 更高 | 一般 |
| 布线复杂度 | 稍高 | 较低 |
| 用户体验 | 一般 | 优秀 |
| 集成度 | 低 | 高 |
| 便携性 | 一般 | 强 |

## 详细电路连接图

### 方案一详细连接

```
┌─────────────────────────────────────────────────────────────┐
│                           PC端                              │
└─────────────┬─────────────────────────┬─────────────────────┘
              │                         │
              │ USB接口1                │ USB接口2
              ▼                         ▼
    ┌─────────────────┐         ┌─────────────────┐
    │   GL3523 HUB    │         │    CH340G       │
    │   USB3.0控制器  │         │  串口转USB      │
    └─────────────────┘         └─────────────────┘
              │                         │
              │                         │ UART
    ┌─────────┼─────────┐              ▼
    │         │         │    ┌─────────────────┐
    ▼         ▼         ▼    │  STM32F767VIT6  │
┌───────┐ ┌───────┐ ┌───────┐│    主控制器     │
│端口1  │ │端口2  │ │端口3  ││                 │
└───────┘ └───────┘ └───────┘└─────────────────┘
                              │ │ │ │
                              │ │ │ │ GPIO控制
                              ▼ ▼ ▼ ▼
                        ┌─────────────────┐
                        │  TS3USB221×4    │
                        │   信号切换器    │
                        └─────────────────┘
                              │ │ │ │
                              ▼ ▼ ▼ ▼
                        ┌─────────────────┐
                        │   用户端口1-4   │
                        └─────────────────┘
```

### 信号流程说明

1. **数据路径**：
   - 用户设备 → TS3USB221切换器 → STM32检测 → 授权后切换到GL3523 → PC

2. **控制路径**：
   - PC → CH340G → STM32 UART → GPIO控制TS3USB221

3. **电源路径**：
   - PC USB → 电源管理电路 → 各模块供电

## 优化建议

### 成本优化
- 采用方案一，使用4路HUB芯片
- CH340G可以考虑用更便宜的CH340C
- 如果PC只有一个USB接口，可以外接USB分线器

### 功能优化
- 可以在PCB上预留跳线，支持两种连接方式
- 增加USB接口指示灯，显示连接状态
- 考虑增加USB-C接口支持

## 总结

**推荐使用方案二（集成连接）**：
- GL3525提供5路端口（4路用户+1路系统）
- CH340G集成在HUB内部，占用端口5
- PC端仅需一根USB线，用户体验优秀
- 高集成度设计，便于部署和维护
- 符合工业级产品的集成化趋势

这样设计在略微增加成本的情况下，大幅提升了用户体验和产品的专业性，是面向市场的最优解决方案。